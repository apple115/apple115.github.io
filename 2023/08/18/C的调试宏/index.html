<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="Cçš„è°ƒè¯•å®" />
    <meta name="hexo-theme-A4" content="v1.6.9" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>coding life | </title>

    
        
            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/reset.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/markdown.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/fonts.css">
 
            <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
            
                
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/waline.css">

            
        
    
    
<link rel="stylesheet" href="/css/ui.css">
 
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>
    
    <body>
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">coding life</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Cçš„è°ƒè¯•å®
        </div>
      
    

    <div class="post-md">
        
            
        
        <p>æˆ‘åœ¨å­¦ä¹ å…¶ä»–è¯­è¨€ä¸­çœ‹åˆ°è®¸å¤šè¯­è¨€å¯¹äºé”™è¯¯å¤„ç†æœ‰ç€ä¸é”™çš„å¤„ç†<br>ä½†æˆ‘åœ¨Cè¯­è¨€ä¸­å‡ ä¹æ²¡æ³•çœ‹åˆ°ç±»ä¼¼çš„ç”¨æ³•ï¼ˆå¯èƒ½æ˜¯æˆ‘çš„è§è¯†çŸ­æµ…ï¼‰<br>try catchç­‰</p>
<p>ä½†å½“æˆ‘çœ‹åˆ°&lt;&lt;ç¬¨åŠæ³•å­¦C&gt;&gt;(learn C The Hard Way)ä¸­Zedçš„è°ƒè¯•å®ç»™äº†æˆ‘éå¸¸å¤§çš„å¯å‘</p>
<p>æˆ‘ç”¨çš„ç¯å¢ƒæ˜¯Linux + gcc<br>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å§</p>
<p>Zed åœ¨ä¹¦ä¸­å†™åˆ°</p>
<blockquote>
<p>è¿™ç§æœºåˆ¶å¯ä»¥æ£€æŸ¥ç°å­˜çš„å¤æ‚ä»£ç ä¸­ï¼Œä½ æ‰§è¡Œçš„ä¸œè¥¿æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚å½“ä½ ç¼–å†™æ›´å¤šçš„Cä»£ç æ—¶ï¼Œä½ åº”è¯¥æŒ‰ç…§ä¸‹åˆ—æ¨¡å¼ï¼š<br>1.è°ƒç”¨å‡½æ•°ã€‚<br>2.å¦‚æœè¿”å›å€¼å‡ºç°é”™è¯¯ï¼ˆæ¯æ¬¡éƒ½å¿…é¡»æ£€æŸ¥ï¼‰ã€‚<br>3.æ¸…ç†åˆ›å»ºçš„æ‰€æœ‰èµ„æºã€‚<br>4.æ‰“å°å‡ºæ‰€æœ‰å¯èƒ½æœ‰å¸®åŠ©çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
</blockquote>
<p>æˆ‘è®¤ä¸ºä¸€ä¸ªå‡½æ•°ä¸€å®šè¦æœ‰ä¸€ä¸ªæ£€æµ‹<br>æ²¡æœ‰æµ‹è¯•çš„ä»£ç ä¸€å®šæ˜¯é”™çš„</p>
<p>zed </p>
<pre><code>#ifndef __dbg_h__
#define __dbg_h__

#include &lt;stdio.h&gt;
#include &lt;errno.h&gt;
#include &lt;string.h&gt;

#ifdef NDEBUG
#define debug(M, ...)
#else
#define debug(M, ...) fprintf(stderr, &quot;DEBUG %s:%d: &quot; M &quot;\n&quot;, __FILE__, __LINE__, ##__VA_ARGS__)
#endif

#define clean_errno() (errno == 0 ? &quot;None&quot; : strerror(errno))

#define log_err(M, ...) fprintf(stderr, &quot;[ERROR] (%s:%d: errno: %s) &quot; M &quot;\n&quot;, __FILE__, __LINE__, clean_errno(), ##__VA_ARGS__)

#define log_warn(M, ...) fprintf(stderr, &quot;[WARN] (%s:%d: errno: %s) &quot; M &quot;\n&quot;, __FILE__, __LINE__, clean_errno(), ##__VA_ARGS__)

#define log_info(M, ...) fprintf(stderr, &quot;[INFO] (%s:%d) &quot; M &quot;\n&quot;, __FILE__, __LINE__, ##__VA_ARGS__)

#define check(A, M, ...) if(!(A)) &#123; log_err(M, ##__VA_ARGS__); errno=0; goto error; &#125;

#define sentinel(M, ...)  &#123; log_err(M, ##__VA_ARGS__); errno=0; goto error; &#125;

#define check_mem(A) check((A), &quot;Out of memory.&quot;)

#define check_debug(A, M, ...) if(!(A)) &#123; debug(M, ##__VA_ARGS__); errno=0; goto error; &#125;

#endif
</code></pre>
<p>è®©æˆ‘æ¥è§£è¯»ä¸€ä¸‹</p>
<pre><code>#ifdef NDEBUG
#define debug(M, ...)
#else
#define debug(M, ...) fprintf(stderr, &quot;DEBUG %s:%d: &quot; M &quot;\n&quot;, __FILE__, __LINE__, ##__VA_ARGS__)
#endif
</code></pre>
<p><code>ifdef</code> å¦‚æœå®šä¹‰</p>
<p><code>stderr</code> å…¨ç§°<code>standard streams error</code> æ ‡å‡†é”™è¯¯æµä¸è¿™ä¸ªç›¸ä¼¼çš„<code>stdin</code>,<code>stdout</code></p>
<p><code>fprintf(stderr, &quot;DEBUG %s:%d: &quot; M &quot;\n&quot;, __FILE__, __LINE__, ##__VA_ARGS__)</code>è¿™æ˜¯å®çš„ä¸»ä½“éƒ¨åˆ†ï¼Œå®ƒä½¿ç”¨<code>fprintf</code>å‡½æ•°å°†ä¿¡æ¯è¾“å‡ºåˆ°<code>stderr</code></p>
<p><code>M</code>æ˜¯ä¼ é€’ç»™å®çš„ç¬¬ä¸€ä¸ªå‚æ•°</p>
<p><code>__FILE__</code> å½“å‰æ–‡ä»¶å<code>__LINE__</code> å½“å‰è¡Œå·</p>
<p><code>##__VA_ARGS__</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å®ï¼Œå®ƒå°†è¢«æ›¿æ¢ä¸ºä¼ é€’ç»™debugå®çš„æ‰€æœ‰å‚æ•°ï¼ˆé™¤äº†<code>M</code>ï¼‰ã€‚</p>
<pre><code>#define log_err(M, ...) fprintf(stderr, &quot;[ERROR] (%s:%d: errno: %s) &quot; M &quot;\n&quot;, __FILE__, __LINE__, clean_errno(), ##__VA_ARGS__)
</code></pre>
<p><code>clean_errno</code>å®ç”¨äºè·å–errnoçš„å®‰å…¨å¯è¯»çš„ç‰ˆæœ¬</p>
<pre><code>#define check(A, M, ...) if(!(A)) &#123; log_err(M, ##__VA_ARGS__); errno=0; goto error; &#125;
</code></pre>
<p><code>check</code>ä¼šä¿è¯æ¡ä»¶<code>A</code>ä¸ºçœŸï¼Œå¦åˆ™ä¼šè®°å½•é”™è¯¯<code>M</code>ï¼ˆå¸¦ç€<code>log_err</code>çš„å¯å˜å‚æ•°ï¼‰ï¼Œä¹‹åè·³åˆ°å‡½æ•°çš„<code>error:</code>åŒºåŸŸæ¥æ‰§è¡Œæ¸…ç†ã€‚<br>è¿™æ˜¯æˆ‘è§è¿‡æœ€åƒtry catch ç”¨æ³•çš„åœ°æ–¹</p>
<p>çœ‹çœ‹ç”¨æ³•</p>
<pre><code>#include &quot;dbg.h&quot;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;


void test_debug()
&#123;
    // notice you don&#39;t need the \n
    debug(&quot;I have Brown Hair.&quot;);

    // passing in arguments like printf
    debug(&quot;I am %d years old.&quot;, 37);
&#125;

void test_log_err()
&#123;
    log_err(&quot;I believe everything is broken.&quot;);
    log_err(&quot;There are %d problems in %s.&quot;, 0, &quot;space&quot;);
&#125;

void test_log_warn()
&#123;
    log_warn(&quot;You can safely ignore this.&quot;);
    log_warn(&quot;Maybe consider looking at: %s.&quot;, &quot;/etc/passwd&quot;);
&#125;

void test_log_info()
&#123;
    log_info(&quot;Well I did something mundane.&quot;);
    log_info(&quot;It happened %f times today.&quot;, 1.3f);
&#125;

int test_check(char *file_name)
&#123;
    FILE *input = NULL;
    char *block = NULL;

    block = malloc(100);
    check_mem(block); // should work

    input = fopen(file_name,&quot;r&quot;);
    check(input, &quot;Failed to open %s.&quot;, file_name);

    free(block);
    fclose(input);
    return 0;

error:
    if(block) free(block);
    if(input) fclose(input);
    return -1;
&#125;

int test_sentinel(int code)
&#123;
    char *temp = malloc(100);
    check_mem(temp);

    switch(code) &#123;
        case 1:
            log_info(&quot;It worked.&quot;);
            break;
        default:
            sentinel(&quot;I shouldn&#39;t run.&quot;);
    &#125;

    free(temp);
    return 0;

error:
    if(temp) free(temp);
    return -1;
&#125;

int test_check_mem()
&#123;
    char *test = NULL;
    check_mem(test);

    free(test);
    return 1;

error:
    return -1;
&#125;

int test_check_debug()
&#123;
    int i = 0;
    check_debug(i != 0, &quot;Oops, I was 0.&quot;);

    return 0;
error:
    return -1;
&#125;

int main(int argc, char *argv[])
&#123;
    check(argc == 2, &quot;Need an argument.&quot;);

    test_debug();
    test_log_err();
    test_log_warn();
    test_log_info();

    check(test_check(&quot;ex20.c&quot;) == 0, &quot;failed with ex20.c&quot;);
    check(test_check(argv[1]) == -1, &quot;failed with argv&quot;);
    check(test_sentinel(1) == 0, &quot;test_sentinel failed.&quot;);
    check(test_sentinel(100) == -1, &quot;test_sentinel failed.&quot;);
    check(test_check_mem() == -1, &quot;test_check_mem failed.&quot;);
    check(test_check_debug() == -1, &quot;test_check_debug failed.&quot;);

    return 0;

error:
    return 1;
&#125;
</code></pre>
<p>è¾“å‡º</p>
<pre><code>$ make ex20
cc -Wall -g -DNDEBUG    ex20.c   -o ex20
$ ./ex20 test
[ERROR] (ex20.c:16: errno: None) I believe everything is broken.
[ERROR] (ex20.c:17: errno: None) There are 0 problems in space.
[WARN] (ex20.c:22: errno: None) You can safely ignore this.
[WARN] (ex20.c:23: errno: None) Maybe consider looking at: /etc/passwd.
[INFO] (ex20.c:28) Well I did something mundane.
[INFO] (ex20.c:29) It happened 1.300000 times today.
[ERROR] (ex20.c:38: errno: No such file or directory) Failed to open test.
[INFO] (ex20.c:57) It worked.
[ERROR] (ex20.c:60: errno: None) I shouldn&#39;t run.
[ERROR] (ex20.c:74: errno: None) Out of memory.
</code></pre>
<p>çœŸçš„æ˜¯éå¸¸å¼ºå¤§çš„zedçš„å®</p>

    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-08-18</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« apple115</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/linux/'>
                            linux
                        </a>
                    
                </span>
             
             
        
        </i>
    </div>
    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        ä»¥ä¸Šã€‚ 
    </div>
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://apple115-github-aheo54k7t-apple115.vercel.app/',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'æ­£ç¡®çš„é‚®ç®±åœ°å€ï¼Œå›å¤å°†èƒ½å¾—åˆ°é‚®ä»¶é€šçŸ¥ã€‚', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>


    </div>


     
</div>



                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2023 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
        
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/a11y-dark.min.css">

        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlight.min.js"></script>

        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js"></script>

    


<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>
                </div>
            
    </body>
</html>